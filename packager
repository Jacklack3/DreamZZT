#!/usr/bin/make -f

DESTDIR=dreamzzt-3.1.`svnversion .`

dummy:
	echo "Please specify a platform: dc, linux, nds, osx"

dc: data
	sh-elf-objcopy -R .stack -O binary dreamzzt dreamzzt.bin
	cp dreamzzt.bin ${DESTDIR}
	zip dist/${DESTDIR}-dc.zip ${DESTDIR}/*
	rm -rf ${DESTDIR}

nds: data
	cp dreamzzt.nds dreamzzt.ds.gba ${DESTDIR}
	zip dist/${DESTDIR}-nds.zip ${DESTDIR}/*
	rm -rf ${DESTDIR}

linux:
	sed "s/\$$WCREV\\$$/`svnversion .`/" < loki/setup.data/setup.xml.in > loki/setup.data/setup.xml
	strip dreamzzt
	cp dreamzzt loki/bin/Linux/x86/glibc-2.1
	mkdir -p dist 
	~/loki_setup/makeself/makeself.sh --follow loki dist/dreamzzt-3.1.`svnversion .`-linux.run dreamzzt ./setup.sh

osx:
	cp -R build/Deployment/DreamZZT.app ${DESTDIR}
	zip dist/${DESTDIR}-mac.zip ${DESTDIR}/*
	rm -rf ${DESTDIR}

data:
	mkdir -p ${DESTDIR}
	mkdir -p dist
	cp resources/*.zzt resources/*.szt resources/zzt-ascii.png ${DESTDIR}
	cp doc/* COPYING ChangeLog ${DESTDIR}
